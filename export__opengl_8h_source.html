<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SRBA: Sparser Relative Bundle Adjustment: srba/impl/export_opengl.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SRBA: Sparser Relative Bundle Adjustment
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">srba/impl/export_opengl.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* +---------------------------------------------------------------------------+</span>
<a name="l00002"></a>00002 <span class="comment">   |                     Mobile Robot Programming Toolkit (MRPT)               |</span>
<a name="l00003"></a>00003 <span class="comment">   |                          http://www.mrpt.org/                             |</span>
<a name="l00004"></a>00004 <span class="comment">   |                                                                           |</span>
<a name="l00005"></a>00005 <span class="comment">   | Copyright (c) 2005-2015, Individual contributors, see AUTHORS file        |</span>
<a name="l00006"></a>00006 <span class="comment">   | See: http://www.mrpt.org/Authors - All rights reserved.                   |</span>
<a name="l00007"></a>00007 <span class="comment">   | Released under BSD License. See details in http://www.mrpt.org/License    |</span>
<a name="l00008"></a>00008 <span class="comment">   +---------------------------------------------------------------------------+ */</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#pragma once</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/_c_set_of_objects_8h.html">mrpt/opengl/CSetOfObjects.h</a>&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/stock__objects_8h.html">mrpt/opengl/stock_objects.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/_c_disk_8h.html">mrpt/opengl/CDisk.h</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/_c_set_of_lines_8h.html">mrpt/opengl/CSetOfLines.h</a>&gt;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;export_opengl_landmark_renderers.h&quot;</span> <span class="comment">// Declare LandmarkRendererBase&lt;&gt; specializations</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="keyword">namespace </span>srba {
<a name="l00020"></a>00020 <span class="comment">//</span>
<a name="l00021"></a>00021 <span class="comment">// RbaEngine&lt;&gt;::build_opengl_representation</span>
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a>00023 <span class="keyword">template</span> &lt;<span class="keyword">class</span> KF2KF_POSE_TYPE,<span class="keyword">class</span> LM_TYPE,<span class="keyword">class</span> OBS_TYPE,<span class="keyword">class</span> RBA_OPTIONS&gt;
<a name="l00024"></a><a class="code" href="classsrba_1_1RbaEngine.html#a33b5953c7bc054662b4154b8b3b489f9">00024</a> <span class="keywordtype">void</span> <a class="code" href="classsrba_1_1RbaEngine.html#a33b5953c7bc054662b4154b8b3b489f9">RbaEngine&lt;KF2KF_POSE_TYPE,LM_TYPE,OBS_TYPE,RBA_OPTIONS&gt;::build_opengl_representation</a>(
<a name="l00025"></a>00025     <span class="keyword">const</span> srba::TKeyFrameID root_keyframe,
<a name="l00026"></a>00026     <span class="keyword">const</span> <a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html">TOpenGLRepresentationOptions</a> &amp;options,
<a name="l00027"></a>00027     mrpt::opengl::CSetOfObjectsPtr out_scene,
<a name="l00028"></a>00028     mrpt::opengl::CSetOfObjectsPtr out_root_tree
<a name="l00029"></a>00029     )<span class="keyword"> const</span>
<a name="l00030"></a>00030 <span class="keyword"></span>{
<a name="l00031"></a>00031     <span class="keyword">using namespace </span>std;
<a name="l00032"></a>00032     <span class="keyword">using namespace </span>mrpt::utils;
<a name="l00033"></a>00033     <span class="keyword">using</span> <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1poses_1_1_c_pose3_d.html">mrpt::poses::CPose3D</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="comment">// Generate 3D scene:</span>
<a name="l00036"></a>00036     <span class="comment">// ------------------------------</span>
<a name="l00037"></a>00037     <span class="keywordflow">if</span> (out_scene)
<a name="l00038"></a>00038     {
<a name="l00039"></a>00039         out_scene-&gt;clear();
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="keywordflow">if</span> (!rba_state.keyframes.empty())
<a name="l00042"></a>00042         {
<a name="l00043"></a>00043             <span class="comment">// Use a spanning tree to estimate the global pose of every node</span>
<a name="l00044"></a>00044             <span class="comment">//  starting (root) at the given keyframe:</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046             frameid2pose_map_t  spantree;
<a name="l00047"></a>00047             create_complete_spanning_tree(root_keyframe,spantree, options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#a6bef428efc94d1442ee3e98bb18ab054" title="Maximum spanning tree depth for reconstructing relative poses (default=std::numeric_limits&lt;size_t&gt;::m...">span_tree_max_depth</a> );
<a name="l00048"></a>00048 
<a name="l00049"></a>00049             <span class="comment">// For each key-frame, add a 3D corner:</span>
<a name="l00050"></a>00050             <span class="keywordflow">for</span> (<span class="keyword">typename</span> frameid2pose_map_t::const_iterator itP = spantree.begin();itP!=spantree.end();++itP)
<a name="l00051"></a>00051             {
<a name="l00052"></a>00052                 <span class="keywordflow">if</span> (root_keyframe==itP-&gt;first) <span class="keywordflow">continue</span>;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054                 <span class="keyword">const</span> CPose3D p = itP-&gt;second.pose;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056                 <span class="keyword">const</span> <span class="keywordtype">bool</span> is_elevated_hiearchical_kf = (options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#ae2944700f847245044790a12d7c484fc" title="(default:false) Draw in a special way those KFs with more than one kf-to-kf edge, to help visualize t...">draw_kf_hierarchical</a> &amp;&amp; rba_state.keyframes[itP-&gt;first].adjacent_k2k_edges.size()&gt;=2);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058                 mrpt::opengl::CSetOfObjectsPtr o = mrpt::opengl::stock_objects::CornerXYZSimple(is_elevated_hiearchical_kf ? 3.0 : 0.75, is_elevated_hiearchical_kf ? 4.0 : 2.0);
<a name="l00059"></a>00059                 <span class="keywordflow">if</span> (options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#ae2944700f847245044790a12d7c484fc" title="(default:false) Draw in a special way those KFs with more than one kf-to-kf edge, to help visualize t...">draw_kf_hierarchical</a>) {
<a name="l00060"></a>00060                     <span class="comment">// Hierarchical map:</span>
<a name="l00061"></a>00061                     CPose3D p_mod = p;
<a name="l00062"></a>00062                     <span class="keywordflow">if</span> (is_elevated_hiearchical_kf)
<a name="l00063"></a>00063                         p_mod.z_incr( options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#acab1970f518ac4da531573b6bfd352a7" title="(default: 10.0) (If draw_kf_hierarchical==true) The height in Z to offset the &quot;border&quot; KFs...">draw_kf_hierarchical_height</a> );
<a name="l00064"></a>00064                     o-&gt;setPose(p_mod);
<a name="l00065"></a>00065                 } <span class="keywordflow">else</span> {
<a name="l00066"></a>00066                     <span class="comment">// Flat map:</span>
<a name="l00067"></a>00067                     o-&gt;setPose(p);
<a name="l00068"></a>00068                 }
<a name="l00069"></a>00069                 o-&gt;setName( mrpt::format(<span class="stringliteral">&quot;%d&quot;</span>,<span class="keywordtype">int</span>(itP-&gt;first)).c_str() );
<a name="l00070"></a>00070                 o-&gt;enableShowName();
<a name="l00071"></a>00071                 out_scene-&gt;insert(o);
<a name="l00072"></a>00072             }
<a name="l00073"></a>00073             <span class="comment">// And a bigger one for the root:</span>
<a name="l00074"></a>00074             {
<a name="l00075"></a>00075                 mrpt::opengl::CSetOfObjectsPtr o = mrpt::opengl::stock_objects::CornerXYZSimple(1.0,4.0);
<a name="l00076"></a>00076                 <span class="comment">//o-&gt;setPose(...);  // At the origin</span>
<a name="l00077"></a>00077                 out_scene-&gt;insert(o);
<a name="l00078"></a>00078             }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080             <span class="comment">// Draw all edges between frames:</span>
<a name="l00081"></a>00081             mrpt::opengl::CSetOfLinesPtr gl_edges = <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_set_of_lines.html#ae9d92df71e3abe3706a0e43be83cdfb8">mrpt::opengl::CSetOfLines::Create</a>();
<a name="l00082"></a>00082             gl_edges-&gt;setColor(1,0,1); <span class="comment">// Magenta, in order to not confuse them with the standard lines of a grid plane</span>
<a name="l00083"></a>00083             <span class="keywordflow">for</span> (<span class="keyword">typename</span> rba_problem_state_t::k2k_edges_deque_t::const_iterator itEdge = rba_state.k2k_edges.begin();itEdge!=rba_state.k2k_edges.end();++itEdge)
<a name="l00084"></a>00084             {
<a name="l00085"></a>00085                 CPose3D p1;
<a name="l00086"></a>00086                 <span class="keywordflow">if</span> (itEdge-&gt;from!=root_keyframe)
<a name="l00087"></a>00087                 {
<a name="l00088"></a>00088                     <span class="keyword">typename</span> frameid2pose_map_t::const_iterator itN1 = spantree.find(itEdge-&gt;from);
<a name="l00089"></a>00089                     <span class="keywordflow">if</span>(itN1==spantree.end())
<a name="l00090"></a>00090                         <span class="keywordflow">continue</span>;
<a name="l00091"></a>00091                     p1 = itN1-&gt;second.pose;
<a name="l00092"></a>00092                     <span class="keywordflow">if</span> (options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#ae2944700f847245044790a12d7c484fc" title="(default:false) Draw in a special way those KFs with more than one kf-to-kf edge, to help visualize t...">draw_kf_hierarchical</a> &amp;&amp; rba_state.keyframes[itEdge-&gt;from].adjacent_k2k_edges.size()&gt;=2)
<a name="l00093"></a>00093                         p1.z_incr( options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#acab1970f518ac4da531573b6bfd352a7" title="(default: 10.0) (If draw_kf_hierarchical==true) The height in Z to offset the &quot;border&quot; KFs...">draw_kf_hierarchical_height</a> );
<a name="l00094"></a>00094                 }
<a name="l00095"></a>00095                 CPose3D p2;
<a name="l00096"></a>00096                 <span class="keywordflow">if</span> (itEdge-&gt;to!=root_keyframe)
<a name="l00097"></a>00097                 {
<a name="l00098"></a>00098                     <span class="keyword">typename</span> frameid2pose_map_t::const_iterator itN2 = spantree.find(itEdge-&gt;to);
<a name="l00099"></a>00099                     <span class="keywordflow">if</span>(itN2==spantree.end())
<a name="l00100"></a>00100                         <span class="keywordflow">continue</span>;
<a name="l00101"></a>00101                     p2 = itN2-&gt;second.pose;
<a name="l00102"></a>00102                     <span class="keywordflow">if</span> (options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#ae2944700f847245044790a12d7c484fc" title="(default:false) Draw in a special way those KFs with more than one kf-to-kf edge, to help visualize t...">draw_kf_hierarchical</a> &amp;&amp; rba_state.keyframes[itEdge-&gt;to].adjacent_k2k_edges.size()&gt;=2)
<a name="l00103"></a>00103                         p2.z_incr( options.<a class="code" href="structsrba_1_1RbaEngine_1_1TOpenGLRepresentationOptions.html#acab1970f518ac4da531573b6bfd352a7" title="(default: 10.0) (If draw_kf_hierarchical==true) The height in Z to offset the &quot;border&quot; KFs...">draw_kf_hierarchical_height</a> );
<a name="l00104"></a>00104                 }
<a name="l00105"></a>00105                 gl_edges-&gt;appendLine(p1.x(),p1.y(),p1.z(), p2.x(),p2.y(),p2.z());
<a name="l00106"></a>00106             }
<a name="l00107"></a>00107             out_scene-&gt;insert(gl_edges);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109             <span class="comment">// Render landmarks:</span>
<a name="l00110"></a>00110             <a class="code" href="structsrba_1_1LandmarkRendererBase.html">LandmarkRendererBase&lt;typename landmark_t::render_mode_t&gt;::render</a>(*<span class="keyword">this</span>,root_keyframe,spantree, options,*out_scene);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         } <span class="comment">// end if graph is not empty</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     } <span class="comment">// end of &quot;out_scene&quot;</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="comment">// Generate 2D tree:</span>
<a name="l00118"></a>00118     <span class="comment">// ------------------------------</span>
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (out_root_tree)
<a name="l00120"></a>00120     {
<a name="l00121"></a>00121         out_root_tree-&gt;clear();
<a name="l00122"></a>00122 
<a name="l00123"></a>00123         <span class="keyword">const</span> <span class="keywordtype">float</span> NODE_RADIUS = 1;
<a name="l00124"></a>00124         <span class="keyword">const</span> <span class="keywordtype">float</span> ROW_HEIGHT  = 4*NODE_RADIUS;
<a name="l00125"></a>00125         <span class="keyword">const</span> <span class="keywordtype">float</span> COL_WIDTH   = 3*NODE_RADIUS;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keyword">typename</span> rba_problem_state_t::TSpanningTree::next_edge_maps_t::const_iterator it_st_root = rba_state.spanning_tree.sym.next_edge.find(root_keyframe);
<a name="l00128"></a>00128         <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/mrpt__macros_8h.html#a47eb5a445c2bf3d9190396510ea9683e">ASSERT_</a>(it_st_root != rba_state.spanning_tree.sym.next_edge.end())
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keyword">const</span> std::map&lt;TKeyFrameID,TSpanTreeEntry&gt; &amp; st_root = it_st_root-&gt;second;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         std::map&lt;TKeyFrameID,topo_dist_t&gt;  children_depths;
<a name="l00133"></a>00133         std::map&lt;topo_dist_t,std::vector&lt;TKeyFrameID&gt; &gt; children_by_depth;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">// roots are not in spanning trees (&quot;spanning_tree.sym.next_edge&quot;)</span>
<a name="l00136"></a>00136         children_depths[root_keyframe]=0;
<a name="l00137"></a>00137         children_by_depth[0].push_back(root_keyframe);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">// Go thru the tree to realize of its size:</span>
<a name="l00140"></a>00140         <span class="comment">//size_t max_nodes_per_level = 1;</span>
<a name="l00141"></a>00141         <span class="keywordtype">size_t</span> max_depth = 0;
<a name="l00142"></a>00142         <span class="keywordflow">for</span> (std::map&lt;TKeyFrameID,TSpanTreeEntry&gt;::const_iterator it=st_root.begin();it!=st_root.end();++it)
<a name="l00143"></a>00143         {
<a name="l00144"></a>00144             <span class="keyword">const</span> topo_dist_t depth = it-&gt;second.distance;
<a name="l00145"></a>00145             children_depths[it-&gt;first] = depth;
<a name="l00146"></a>00146             mrpt::utils::keep_max(max_depth, depth);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148             std::vector&lt;TKeyFrameID&gt; &amp; v = children_by_depth[depth];
<a name="l00149"></a>00149             v.push_back(it-&gt;first);
<a name="l00150"></a>00150             <span class="comment">//mrpt::utils::keep_max(max_nodes_per_level, v.size());</span>
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         <span class="comment">// Generate (x,y) coords for each node:</span>
<a name="l00154"></a>00154         std::map&lt;TKeyFrameID, mrpt::math::TPoint3Df&gt; node_coords;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> d=0;d&lt;=max_depth;d++)
<a name="l00157"></a>00157         {
<a name="l00158"></a>00158             <span class="keyword">const</span> <span class="keywordtype">float</span> y = -(d*ROW_HEIGHT);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160             std::vector&lt;TKeyFrameID&gt; &amp; v = children_by_depth[d];
<a name="l00161"></a>00161             <span class="keyword">const</span> <span class="keywordtype">float</span> row_width = v.size()*COL_WIDTH;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163             <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0;i&lt;v.size();i++)
<a name="l00164"></a>00164             {
<a name="l00165"></a>00165                 <span class="keyword">const</span> <span class="keywordtype">float</span> x = - 0.5f*row_width + COL_WIDTH*i;
<a name="l00166"></a>00166                 node_coords[v[i]] = <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/structmrpt_1_1math_1_1_t_point3_df.html">mrpt::math::TPoint3Df</a>(x,y,0);
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="comment">// Draw edges in tree:</span>
<a name="l00171"></a>00171         mrpt::opengl::CSetOfLinesPtr gl_edges = <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_set_of_lines.html#ae9d92df71e3abe3706a0e43be83cdfb8">mrpt::opengl::CSetOfLines::Create</a>();
<a name="l00172"></a>00172         gl_edges-&gt;setLineWidth(1.5);
<a name="l00173"></a>00173         gl_edges-&gt;setColor_u8(<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/structmrpt_1_1utils_1_1_t_color.html">mrpt::utils::TColor</a>(0xff,0xff,0x00));
<a name="l00174"></a>00174         out_root_tree-&gt;insert(gl_edges);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <span class="keyword">typename</span> rba_problem_state_t::TSpanningTree::all_edges_maps_t::const_iterator it_edges_from_root = rba_state.spanning_tree.sym.all_edges.find(root_keyframe);
<a name="l00177"></a>00177         <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/mrpt__macros_8h.html#a47eb5a445c2bf3d9190396510ea9683e">ASSERT_</a>(it_edges_from_root != rba_state.spanning_tree.sym.all_edges.end())
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="keyword">const</span> std::map&lt;TKeyFrameID, typename rba_problem_state_t::k2k_edge_vector_t&gt; edges_from_root = it_edges_from_root-&gt;second;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         for (<span class="keyword">typename</span> std::map&lt;TKeyFrameID, typename rba_problem_state_t::k2k_edge_vector_t&gt;::const_iterator it=edges_from_root.begin();it!=edges_from_root.end();++it)
<a name="l00182"></a>00182         {
<a name="l00183"></a>00183             <span class="keyword">const</span> <span class="keyword">typename</span> rba_problem_state_t::k2k_edge_vector_t &amp; edges_to_j = it-&gt;second;
<a name="l00184"></a>00184             <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k=0;k&lt;edges_to_j.size();k++)
<a name="l00185"></a>00185             {
<a name="l00186"></a>00186                 <span class="keyword">const</span> TKeyFrameID id1 = edges_to_j[k]-&gt;from;
<a name="l00187"></a>00187                 <span class="keyword">const</span> TKeyFrameID id2 = edges_to_j[k]-&gt;to;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                 gl_edges-&gt;appendLine(node_coords[id1], node_coords[id2]);
<a name="l00190"></a>00190             }
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="comment">// And on the top, draw the nodes:</span>
<a name="l00194"></a>00194         <span class="keywordflow">for</span> (std::map&lt;TKeyFrameID, mrpt::math::TPoint3Df&gt;::const_iterator it=node_coords.begin();it!=node_coords.end();++it)
<a name="l00195"></a>00195             gl_aux_draw_node(*out_root_tree, mrpt::format(<span class="stringliteral">&quot;%u&quot;</span>, static_cast&lt;unsigned int&gt;(it-&gt;first) ), it-&gt;second.x, it-&gt;second.y);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     } <span class="comment">// end render &quot;2D tree&quot;</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="keyword">template</span> &lt;<span class="keyword">class</span> KF2KF_POSE_TYPE,<span class="keyword">class</span> LM_TYPE,<span class="keyword">class</span> OBS_TYPE,<span class="keyword">class</span> RBA_OPTIONS&gt;
<a name="l00203"></a>00203 <span class="keywordtype">void</span> <a class="code" href="classsrba_1_1RbaEngine.html">RbaEngine&lt;KF2KF_POSE_TYPE,LM_TYPE,OBS_TYPE,RBA_OPTIONS&gt;::gl_aux_draw_node</a>(<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_set_of_objects.html">mrpt::opengl::CSetOfObjects</a> &amp;soo, <span class="keyword">const</span> std::string &amp;label, <span class="keyword">const</span> <span class="keywordtype">float</span> x, <span class="keyword">const</span> <span class="keywordtype">float</span> y)<span class="keyword"> const</span>
<a name="l00204"></a>00204 <span class="keyword"></span>{
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206         mrpt::opengl::CDiskPtr obj = <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_disk.html#a042242ab3ce53e8a2b41a59acd91af63">mrpt::opengl::CDisk::Create</a>();
<a name="l00207"></a>00207         obj-&gt;setDiskRadius(1,0);
<a name="l00208"></a>00208         obj-&gt;setColor_u8(<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/structmrpt_1_1utils_1_1_t_color.html">mrpt::utils::TColor</a>(0x00,0x00,0x00, 0xa0));
<a name="l00209"></a>00209         obj-&gt;setLocation(x,y,0);
<a name="l00210"></a>00210         soo.<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_set_of_objects.html#af2705e63af3a6b315d65acd69d6b48f3">insert</a>(obj);
<a name="l00211"></a>00211     }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214         mrpt::opengl::CText3DPtr obj = <a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_text3_d.html#a973349b6d8177a4e878084202e053727">mrpt::opengl::CText3D::Create</a>(label);
<a name="l00215"></a>00215         obj-&gt;setFont(<span class="stringliteral">&quot;sans&quot;</span>);
<a name="l00216"></a>00216         obj-&gt;setColor_u8(<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/structmrpt_1_1utils_1_1_t_color.html">mrpt::utils::TColor</a>(0xff,0xff,0xff));
<a name="l00217"></a>00217         obj-&gt;setScale(0.9);
<a name="l00218"></a>00218         obj-&gt;setLocation(x-0.5,y-0.5,0);
<a name="l00219"></a>00219         soo.<a class="codeRef" doxygen="dox_mrpt.tag:http://reference.mrpt.org/devel//" href="http://reference.mrpt.org/devel/classmrpt_1_1opengl_1_1_c_set_of_objects.html#af2705e63af3a6b315d65acd69d6b48f3">insert</a>(obj);
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 } <span class="comment">// End of namespaces</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Nov 9 2015 10:15:30 for SRBA: Sparser Relative Bundle Adjustment by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
